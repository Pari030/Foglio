<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout (~{::section})}">
<head>
    <title>Foglio - I tuoi file</title>
</head>
<body>
<section>
    <div class="dashboard-header">
        <h1>I tuoi file</h1>
        <a href="/ui/upload" class="btn btn-primary">Carica nuovo file</a>
    </div>

    <div th:if="${user}">
        <div class="dashboard-stats">
            <div class="stat-card">
                <h3>Totale file</h3>
                <p th:text="${#lists.size(files)}"></p>
            </div>
            <div class="stat-card">
                <h3>Spazio utilizzato</h3>
                <p th:text="${totalSize / 1024 + ' KB'}"></p>
            </div>
        </div>

        <div th:if="${#lists.isEmpty(files)}" class="empty-state">
            <p>Non hai ancora caricato nessun file.</p>
            <a href="/ui/upload" class="btn btn-secondary">Carica il primo file</a>
        </div>

        <div th:if="${not #lists.isEmpty(files)}">
            <table class="files-table">
                <thead>
                <tr>
                    <th>Nome</th>
                    <th>Tipo</th>
                    <th>Dimensione</th>
                    <th>Pubblico</th>
                    <th>Azioni</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="f : ${files}">
                    <td th:text="${f.originalName}"></td>
                    <td th:text="${f.contentType}"></td>
                    <td th:text="${f.size / 1024 + ' KB'}"></td>
                    <td>
                        <span th:if="${f.isPublic}" class="badge badge-success">SÃ¬</span>
                        <span th:if="${not f.isPublic}" class="badge badge-secondary">No</span>
                    </td>
                    <td class="actions">
                        <a th:href="@{/api/files/{id}/metadata(id=${f.id})}" class="btn btn-sm btn-info">Metadati</a>
                        <span th:if="${#strings.startsWith(f.contentType, 'image/')}" class="action-spacer">|</span>
                        <a th:if="${#strings.startsWith(f.contentType, 'image/')}" th:href="@{/api/files/{id}/preview(id=${f.id})}" class="btn btn-sm btn-warning">Anteprima</a>
                        <span class="action-spacer">|</span>
                        <a th:href="@{/api/files/{id}/download(id=${f.id})}" class="btn btn-sm btn-success">Scarica</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div th:if="${user} == null">
        <p>Devi essere autenticato per vedere i tuoi file. <a href="/ui/login">Accedi</a>.</p>
    </div>
</section>
</body>
</html>
